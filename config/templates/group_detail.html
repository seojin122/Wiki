<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki - ëª¨ì„ ìƒì„¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-button.active { border-bottom: 4px solid; border-color: #2563EB; color: #2563EB; font-weight: 600; }
    </style>
</head>
<body class="min-h-screen antialiased">
    {% include 'components/header.html' %}

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <section id="detail-page" class="space-y-8">
            <button onclick="window.location.href='/'" class="flex items-center text-blue-600 hover:text-blue-800 transition duration-150 mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"></path></svg>
                <span class="ml-1">ëª¨ì„ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
            </button>
            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500">
                {% if club %}
                    <span id="detail-category" class="text-sm font-semibold px-3 py-1 bg-blue-100 text-blue-600 rounded-full"> {{ club.category }}</span>
                    <div class="flex justify-between items-start mt-3">
                        <h2 id="detail-name" class="text-4xl font-extrabold text-gray-900">{{ club.name }}</h2>
                        {% if is_member %}
                            <p class="text-base text-green-600 font-semibold mt-4">âœ… ë‹¹ì‹ ì€ ì´ ëª¨ì„ì˜ ì •ì‹ ë©¤ë²„ì…ë‹ˆë‹¤.</p>
                            <button onclick="document.getElementById('leave-modal').classList.remove('hidden')" 
                                class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition duration-200 text-sm">
                                ğŸšª ëª¨ì„ íƒˆí‡´
                            </button>
                        {% else %}
                            {% if club and not is_member and not is_leader %}
                                <form method="post" action="{% url 'Wiki:group_join' group_id=club.id %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-200 text-sm">
                                        ğŸ¤ ê°€ì… ì‹ ì²­
                                    </button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </div>

                    <p id="detail-region" class="text-lg text-gray-600 mt-2">í™œë™ ì§€ì—­: {{ club.region }}</p>
                    <p id="detail-member-count" class="text-base text-gray-500 mt-1">í˜„ì¬ ë©¤ë²„: {{ club.members }}ëª…</p>
                    
                {% else %}
                    <span class="text-sm font-semibold px-3 py-1 bg-red-100 text-red-600 rounded-full">ì˜¤ë¥˜</span>
                    <h2 class="mt-3 text-4xl font-extrabold text-gray-900">ëª¨ì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h2>
                    <p class="text-lg text-gray-600 mt-2">ì˜ëª»ëœ ëª¨ì„ ì •ë³´ì…ë‹ˆë‹¤.</p>
                {% endif %}
            </div>
            
            {% include 'components/club_detail_tabs.html' %}

        </section>

        {% if is_member %}
        <button class="fixed bottom-8 right-8 bg-pink-600 hover:bg-pink-700 text-white p-4 rounded-full shadow-2xl transition duration-200"
            onclick="window.location.href='/club/{{ club.id }}/chat'">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        </button>
        {% endif %}

        <div id="apply-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-70 transition-opacity"
            onclick="if(event.target.id === 'apply-modal') document.getElementById('apply-modal').classList.add('hidden')">
                
            <div class="bg-white rounded-xl p-8 max-w-lg w-full m-4 shadow-2xl transform transition-transform duration-300 scale-100">
                <h3 class="text-2xl font-bold text-gray-900 border-b pb-3 mb-5">ëª¨ì„ ê°€ì… ì‹ ì²­</h3>            
                <form onsubmit="handleApply(event)">
                    <div class="space-y-4">
                        <p class="text-sm text-gray-600 mb-4">
                            ê°€ì… ì‹ ì²­ì„œë¥¼ ì‘ì„±í•´ì£¼ì‹œë©´, ë¦¬ë”ì˜ ìŠ¹ì¸ í›„ ì •ì‹ ë©¤ë²„ë¡œ í™œë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>
                        <div>
                            <label for="applicant-name" class="block text-sm font-medium text-gray-700 mb-1">ì‹ ì²­ì ë‹‰ë„¤ì„</label>
                            <input type="text" id="applicant-name" required placeholder="ì˜ˆ: ë†êµ¬í•˜ëŠ” ë³‘ì•„ë¦¬"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="applicant-message" class="block text-sm font-medium text-gray-700 mb-1">ê°€ì… ì‹ ì²­ ë©”ì‹œì§€</label>
                            <textarea id="applicant-message" rows="4" required placeholder="ê°€ì…í•˜ê³  ì‹¶ì€ ì´ìœ ì™€ ê°ì˜¤ë¥¼ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”."
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">í™œë™ ê°€ëŠ¥ ì§€ì—­ (ì„ íƒ)</label>
                            <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                                <option value="">ì„ íƒ ì•ˆ í•¨</option>
                                <option>ì„œìš¸</option>
                                <option>ê²½ê¸°</option>
                            </select>
                        </div>
                    </div>

                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" onclick="document.getElementById('apply-modal').classList.add('hidden')"
                            class="px-5 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition duration-150">
                            ì·¨ì†Œ
                        </button>
                        <button type="submit"
                            class="px-5 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150">
                            ì‹ ì²­ ì™„ë£Œ
                        </button>
                    </div>
                </form>
                <div id="modal-message" class="hidden mt-4 p-3 rounded-lg text-sm"></div>
            </div>
        </div>
        <div id="leave-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-70 transition-opacity"
            onclick="if(event.target.id === 'leave-modal') document.getElementById('leave-modal').classList.add('hidden')">
            <div class="bg-white rounded-xl p-8 max-w-sm w-full m-4 shadow-2xl transform transition-transform duration-300 scale-100">
                <h3 class="text-2xl font-bold text-red-700 border-b pb-3 mb-5">ğŸš¨ ëª¨ì„ íƒˆí‡´ í™•ì¸</h3>            
                <p class="text-gray-700 mb-6">
                    ì •ë§ '{{ club.name }}' ëª¨ì„ì—ì„œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
                    íƒˆí‡´ ì‹œ ë‹¤ì‹œ ê°€ì… ì‹ ì²­ì„ í•´ì•¼ í•©ë‹ˆë‹¤.
                </p>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="document.getElementById('leave-modal').classList.add('hidden')"
                        class="px-5 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition duration-150">
                        ì·¨ì†Œ
                    </button>
                    <button type="button" onclick="handleLeaveClub()"
                        class="px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150">
                        ì˜ˆ, íƒˆí‡´í•©ë‹ˆë‹¤
                    </button>
                </div>
                <div id="leave-message" class="hidden mt-4 p-3 rounded-lg text-sm bg-red-100 text-red-800"></div>
            </div>
        </div>
    </main>
        
    {% include 'components/footer.html' %}

    <script>
    // ê°€ì… ì‹ ì²­ ì²˜ë¦¬
    function handleApply(event) {
        event.preventDefault();
        const name = document.getElementById('applicant-name').value;
        const messageBox = document.getElementById('modal-message');

        messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-800');
        messageBox.classList.add('bg-green-100', 'text-green-800');
        messageBox.textContent =
            `âœ… '${name}'ë‹˜ì˜ ê°€ì… ì‹ ì²­ì´ ëª¨ì„ ë¦¬ë”ì—ê²Œ ì „ë‹¬ë˜ì—ˆìŠµë‹ˆë‹¤. ìŠ¹ì¸ê¹Œì§€ ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.`;

        event.target.reset();
        setTimeout(() => {
            document.getElementById('apply-modal').classList.add('hidden');
            messageBox.classList.add('hidden');
        }, 3000);
    }

    // ëª¨ì„ íƒˆí‡´ ì²˜ë¦¬ (ë‚˜ì¤‘ì— ì‹¤ì œ DB ì—°ë™)
    function handleLeaveClub() {
        const messageBox = document.getElementById('leave-message');
        messageBox.classList.remove('hidden');
        messageBox.textContent = 'âš ï¸ ëª¨ì„ì—ì„œ íƒˆí‡´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. (ì¶”í›„ ì„œë²„ ì—°ë™ í•„ìš”)';
        setTimeout(() => {
            document.getElementById('leave-modal').classList.add('hidden');
            messageBox.classList.add('hidden');
        }, 2000);
    }

    // íƒ­ ë²„íŠ¼ ë™ì‘
    function setupTabs() {
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const targetId = `tab-${button.getAttribute('data-tab')}`;
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                document.getElementById(targetId).classList.add('active');
            });
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        setupTabs();
    });
</script>

</body>
</html>